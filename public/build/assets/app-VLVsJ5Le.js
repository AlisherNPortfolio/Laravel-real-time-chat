function g(s){"@babel/helpers - typeof";return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},g(s)}function a(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")}function C(s,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}function u(s,i,e){return i&&C(s.prototype,i),e&&C(s,e),Object.defineProperty(s,"prototype",{writable:!1}),s}function b(){return b=Object.assign||function(s){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},b.apply(this,arguments)}function c(s,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(i&&i.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),i&&m(s,i)}function v(s){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(s)}function m(s,i){return m=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},m(s,i)}function T(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function E(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function A(s,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return E(s)}function h(s){var i=T();return function(){var n=v(s),t;if(i){var r=v(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return A(this,t)}}var _=function(){function s(){a(this,s)}return u(s,[{key:"listenForWhisper",value:function(e,n){return this.listen(".client-"+e,n)}},{key:"notification",value:function(e){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",e)}},{key:"stopListeningForWhisper",value:function(e,n){return this.stopListening(".client-"+e,n)}}]),s}(),S=function(){function s(i){a(this,s),this.namespace=i}return u(s,[{key:"format",value:function(e){return e.charAt(0)==="."||e.charAt(0)==="\\"?e.substr(1):(this.namespace&&(e=this.namespace+"."+e),e.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(e){this.namespace=e}}]),s}(),y=function(s){c(e,s);var i=h(e);function e(n,t,r){var o;return a(this,e),o=i.call(this),o.name=t,o.pusher=n,o.options=r,o.eventFormatter=new S(o.options.namespace),o.subscribe(),o}return u(e,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(t,r){return this.on(this.eventFormatter.format(t),r),this}},{key:"listenToAll",value:function(t){var r=this;return this.subscription.bind_global(function(o,l){if(!o.startsWith("pusher:")){var p=r.options.namespace.replace(/\./g,"\\"),k=o.startsWith(p)?o.substring(p.length+1):"."+o;t(k,l)}}),this}},{key:"stopListening",value:function(t,r){return r?this.subscription.unbind(this.eventFormatter.format(t),r):this.subscription.unbind(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?this.subscription.unbind_global(t):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(t){return this.on("pusher:subscription_succeeded",function(){t()}),this}},{key:"error",value:function(t){return this.on("pusher:subscription_error",function(r){t(r)}),this}},{key:"on",value:function(t,r){return this.subscription.bind(t,r),this}}]),e}(_),x=function(s){c(e,s);var i=h(e);function e(){return a(this,e),i.apply(this,arguments)}return u(e,[{key:"whisper",value:function(t,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),r),this}}]),e}(y),R=function(s){c(e,s);var i=h(e);function e(){return a(this,e),i.apply(this,arguments)}return u(e,[{key:"whisper",value:function(t,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),r),this}}]),e}(y),L=function(s){c(e,s);var i=h(e);function e(){return a(this,e),i.apply(this,arguments)}return u(e,[{key:"here",value:function(t){return this.on("pusher:subscription_succeeded",function(r){t(Object.keys(r.members).map(function(o){return r.members[o]}))}),this}},{key:"joining",value:function(t){return this.on("pusher:member_added",function(r){t(r.info)}),this}},{key:"whisper",value:function(t,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),r),this}},{key:"leaving",value:function(t){return this.on("pusher:member_removed",function(r){t(r.info)}),this}}]),e}(y),j=function(s){c(e,s);var i=h(e);function e(n,t,r){var o;return a(this,e),o=i.call(this),o.events={},o.listeners={},o.name=t,o.socket=n,o.options=r,o.eventFormatter=new S(o.options.namespace),o.subscribe(),o}return u(e,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(t,r){return this.on(this.eventFormatter.format(t),r),this}},{key:"stopListening",value:function(t,r){return this.unbindEvent(this.eventFormatter.format(t),r),this}},{key:"subscribed",value:function(t){return this.on("connect",function(r){t(r)}),this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,r){var o=this;return this.listeners[t]=this.listeners[t]||[],this.events[t]||(this.events[t]=function(l,p){o.name===l&&o.listeners[t]&&o.listeners[t].forEach(function(k){return k(p)})},this.socket.on(t,this.events[t])),this.listeners[t].push(r),this}},{key:"unbind",value:function(){var t=this;Object.keys(this.events).forEach(function(r){t.unbindEvent(r)})}},{key:"unbindEvent",value:function(t,r){this.listeners[t]=this.listeners[t]||[],r&&(this.listeners[t]=this.listeners[t].filter(function(o){return o!==r})),(!r||this.listeners[t].length===0)&&(this.events[t]&&(this.socket.removeListener(t,this.events[t]),delete this.events[t]),delete this.listeners[t])}}]),e}(_),O=function(s){c(e,s);var i=h(e);function e(){return a(this,e),i.apply(this,arguments)}return u(e,[{key:"whisper",value:function(t,r){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:r}),this}}]),e}(j),N=function(s){c(e,s);var i=h(e);function e(){return a(this,e),i.apply(this,arguments)}return u(e,[{key:"here",value:function(t){return this.on("presence:subscribed",function(r){t(r.map(function(o){return o.user_info}))}),this}},{key:"joining",value:function(t){return this.on("presence:joining",function(r){return t(r.user_info)}),this}},{key:"whisper",value:function(t,r){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:r}),this}},{key:"leaving",value:function(t){return this.on("presence:leaving",function(r){return t(r.user_info)}),this}}]),e}(O),d=function(s){c(e,s);var i=h(e);function e(){return a(this,e),i.apply(this,arguments)}return u(e,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(t,r){return this}},{key:"listenToAll",value:function(t){return this}},{key:"stopListening",value:function(t,r){return this}},{key:"subscribed",value:function(t){return this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,r){return this}}]),e}(_),I=function(s){c(e,s);var i=h(e);function e(){return a(this,e),i.apply(this,arguments)}return u(e,[{key:"whisper",value:function(t,r){return this}}]),e}(d),F=function(s){c(e,s);var i=h(e);function e(){return a(this,e),i.apply(this,arguments)}return u(e,[{key:"here",value:function(t){return this}},{key:"joining",value:function(t){return this}},{key:"whisper",value:function(t,r){return this}},{key:"leaving",value:function(t){return this}}]),e}(d),w=function(){function s(i){a(this,s),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(i),this.connect()}return u(s,[{key:"setOptions",value:function(e){this.options=b(this._defaultOptions,e);var n=this.csrfToken();return n&&(this.options.auth.headers["X-CSRF-TOKEN"]=n,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=n),n=this.options.bearerToken,n&&(this.options.auth.headers.Authorization="Bearer "+n,this.options.userAuthentication.headers.Authorization="Bearer "+n),e}},{key:"csrfToken",value:function(){var e;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(e=document.querySelector('meta[name="csrf-token"]'))?e.getAttribute("content"):null}}]),s}(),q=function(s){c(e,s);var i=h(e);function e(){var n;return a(this,e),n=i.apply(this,arguments),n.channels={},n}return u(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(t,r,o){return this.channel(t).listen(r,o)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new y(this.pusher,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new x(this.pusher,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"encryptedPrivateChannel",value:function(t){return this.channels["private-encrypted-"+t]||(this.channels["private-encrypted-"+t]=new R(this.pusher,"private-encrypted-"+t,this.options)),this.channels["private-encrypted-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new L(this.pusher,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var r=this,o=[t,"private-"+t,"private-encrypted-"+t,"presence-"+t];o.forEach(function(l,p){r.leaveChannel(l)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}]),e}(w),M=function(s){c(e,s);var i=h(e);function e(){var n;return a(this,e),n=i.apply(this,arguments),n.channels={},n}return u(e,[{key:"connect",value:function(){var t=this,r=this.getSocketIO();return this.socket=r(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(t.channels).forEach(function(o){o.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(t,r,o){return this.channel(t).listen(r,o)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new j(this.socket,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new O(this.socket,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new N(this.socket,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var r=this,o=[t,"private-"+t,"presence-"+t];o.forEach(function(l){r.leaveChannel(l)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),e}(w),V=function(s){c(e,s);var i=h(e);function e(){var n;return a(this,e),n=i.apply(this,arguments),n.channels={},n}return u(e,[{key:"connect",value:function(){}},{key:"listen",value:function(t,r,o){return new d}},{key:"channel",value:function(t){return new d}},{key:"privateChannel",value:function(t){return new I}},{key:"encryptedPrivateChannel",value:function(t){return new I}},{key:"presenceChannel",value:function(t){return new F}},{key:"leave",value:function(t){}},{key:"leaveChannel",value:function(t){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}]),e}(w),X=function(){function s(i){a(this,s),this.options=i,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return u(s,[{key:"channel",value:function(e){return this.connector.channel(e)}},{key:"connect",value:function(){this.options.broadcaster=="pusher"?this.connector=new q(this.options):this.options.broadcaster=="socket.io"?this.connector=new M(this.options):this.options.broadcaster=="null"?this.connector=new V(this.options):typeof this.options.broadcaster=="function"&&(this.connector=new this.options.broadcaster(this.options))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(e){return this.connector.presenceChannel(e)}},{key:"leave",value:function(e){this.connector.leave(e)}},{key:"leaveChannel",value:function(e){this.connector.leaveChannel(e)}},{key:"leaveAllChannels",value:function(){for(var e in this.connector.channels)this.leaveChannel(e)}},{key:"listen",value:function(e,n,t){return this.connector.listen(e,n,t)}},{key:"private",value:function(e){return this.connector.privateChannel(e)}},{key:"encryptedPrivate",value:function(e){return this.connector.encryptedPrivateChannel(e)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":g(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var e=this;Vue.http.interceptors.push(function(n,t){e.socketId()&&n.headers.set("X-Socket-ID",e.socketId()),t()})}},{key:"registerAxiosRequestInterceptor",value:function(){var e=this;axios.interceptors.request.use(function(n){return e.socketId()&&(n.headers["X-Socket-Id"]=e.socketId()),n})}},{key:"registerjQueryAjaxSetup",value:function(){var e=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(n,t,r){e.socketId()&&r.setRequestHeader("X-Socket-Id",e.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var e=this;document.addEventListener("turbo:before-fetch-request",function(n){n.detail.fetchOptions.headers["X-Socket-Id"]=e.socketId()})}}]),s}();window.Echo=new X({broadcaster:"pusher",key:"d98ff60c75de6dc30854",cluster:"eu",forceTLS:!0,encrypted:!0,authEndpoint:"/pusher/auth",csrfToken:$('meta[name="csrf-token"]').attr("content")});window.listen=s=>{window.Echo.private("chat."+s).listen(".private-chat",i=>{console.log("%c","background:blue;color:yellow;font-size:24px;","Got message: ",i),$("#message_list").append(window.generateMessageItem(i.message)),isAnotherChat()&&D(i.message.from)})};window.generateMessageItem=(s,i=!1)=>{new Date().getFullYear();const e=typeof s.created_at=="string"?new Date(s.created_at):s.created_at,n=e.getHours(),t=e.getMinutes();return`<li class="clearfix">
        <div class="message-data ${i?"":"text-right"}">
            <span class="message-data-time">${+n>=10?n:"0"+n}:${+t>=10?t:"0"+t}, Today</span>
            ${i?"":'<img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="avatar">'}
        </div>
        <div class="message ${i?"my-message":"other-message float-right"}">${s.message}</div>
    </li>`};function D(s){let i=$("#user__item-"+s);if(Object.keys(i).length==0)return;let e=i.find("span");if(e.length==0)i.append("<span>1</span>");else{let n=+e.text();e.text(++n)}}var f=null;$(document).ready(function(){H(),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("#logout").click(function(s){s.preventDefault(),$.ajax({type:"POST",url:"/logout",success:function(i){i?window.location.href="/login":alert("Error on logout")},error:function(i){}})}),$(document).on("click",".user__menu-item",function(s){const i=$(this);f=i.data("user-id"),$.ajax({type:"GET",url:`/chat-messages/${f}`,success:function(e){if(e.status){const n=e.data;Q(n.user),W(n.messages),setStorageItem("selected_chat",f),z(i)}},error:function(e){console.log(e)}})}),$(document).on("click","#send_btn",function(s){P()}),$(document).on("keypress","#message_input",function(s){if(s.which==13)return P(),!1}),listen(currentUserId)});function Q(s){let i=`<div id="user_header"></a><a href="javascript:void(0);" data-toggle="modal" data-target="#view_info" >
            <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="avatar">
        </a>
        <div class="chat-about">
            <h6 class="m-b-0">${s.name}</h6>
            <small>Last seen: 2 hours ago</small>
        </div></div>`,e=$("#chat_top").find("#user_header");e.length>0&&$(e[0]).remove(),isAnotherChat()&&$("#chat_top").append(i)}function W(s){let i=`<div id="chat_history"><div class="chat-history">
        ${B(s)}
    </div>
    <div class="chat-message clearfix">
        <div class="input-group mb-0">
            <div class="input-group-prepend">
                <span class="input-group-text" id="send_btn"><i class="fa fa-send"></i></span>
            </div>
            <input type="text" id="message_input" class="form-control" placeholder="Enter text here...">
        </div>
    </div></div>`;$("#chat_header").css("height","");let e=$("#chat").find("#chat_history");if(e.length>0&&$(e[0]).remove(),isAnotherChat()){$("#chat").append(i);const n=$("#chat_history");n.scrollTop(n.height())}}function B(s){s.length==0;let i='<ul class="m-b-0" id="message_list">';return s.forEach(e=>{i+=generateMessageItem(e,+e.from==+currentUserId)}),i+="</ul>",i}function z(s){const i=s.find("span");i.length>0&&i[0].remove()}function H(){setStorageItem("selected_chat",0),$("#chat_header").css("height","90vh")}window.getStorageItem=s=>localStorage.getItem(s);window.setStorageItem=(s,i)=>{localStorage.setItem(s,i)};window.isAnotherChat=()=>{const s=getStorageItem("selected_chat");return s!=f||s==0};function P(){let s=$("#message_input"),i=s.val();if(f&&i.length>0){const e={to:f,message:i};$.ajax({method:"POST",url:"/send-private",data:e,success:function(n){const t=generateMessageItem({message:e.message,created_at:new Date},!0);$("#message_list").append(t),s.val(null)}})}}
